var Graphpaper=function(t){if(!(this instanceof Graphpaper))return new Graphpaper(t);if(this._props={width:601,height:801,cellWidth:10,cellHeight:10,minorColor:[0,1,0,.2],majorColor:[0,1,0,.6],majorRows:10,majorCols:10,alpha:1,offsetX:0,offsetY:0,canvasElement:null},t)for(var r in t)this._props.hasOwnProperty(r)&&(this._props[r]=t[r]);this.element=null===this._props.canvasElement?this._createElement():this._props.canvasElement,this._gl=this._getContext(),this._initGL(this._quadVertices()),this._setSize(),this.draw()};Graphpaper.prototype={draw:function(){var t=this._gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_STRIP,0,4)},setProps:function(t){for(var r in t)if(this._props.hasOwnProperty(r))switch(this._props[r]=t[r],r){case"width":case"height":this._setSize();break;case"cellWidth":case"cellHeight":this._setMinor();break;case"majorRows":case"majorCols":this._setMajor();break;case"minorColor":case"majorColor":this._setLineColors();break;case"offsetX":case"offsetY":this._setOffset();break;case"alpha":this._setAlpha()}this.draw()},_shaderProgram:null,_uniforms:null,_attributes:null,_vertexBuffer:null,_setSize:function(){this.element.setAttribute("width",this._props.width),this.element.setAttribute("height",this._props.height),this._gl.viewport(0,0,this._props.width,this._props.height),this._gl.uniform2f(this._uniforms.uResolution,this._props.width,this._props.height),this._setResolution()},_setMinor:function(){this._gl.uniform2f(this._uniforms.uMinor,this._props.cellWidth,this._props.cellHeight),this._setMajor()},_setOffset:function(){this._gl.uniform2f(this._uniforms.uOffset,this._props.offsetX,this._props.offsetY)},_setResolution:function(){this._gl.uniform2f(this._uniforms.uResolution,this._props.width,this._props.height)},_setAlpha:function(){this._gl.uniform1f(this._uniforms.uAlpha,this._props.alpha)},_setLineColors:function(){this._gl.uniform4fv(this._uniforms.uMinorColor,new Float32Array(this._props.minorColor)),this._gl.uniform4fv(this._uniforms.uMajorColor,new Float32Array(this._props.majorColor))},_setMajor:function(){var t=new Float32Array([this._props.majorCols*this._props.cellWidth,this._props.majorRows*this._props.cellHeight]);this._gl.uniform2fv(this._uniforms.uMajor,t)},_createElement:function(){var t=document.createElement("canvas");return t},_getContext:function(){return this.element.getContext("webgl")},_quadVertices:function(){return new Float32Array([1,1,-1,1,1,-1,-1,-1])},_initGL:function(t){this._shaderProgram=this._loadShaders(),this._uniforms=this._getUniforms(this._shaderProgram),this._attributes=this._getAttributes(this._shaderProgram),this._vertexBuffer=this._loadVertexBuffer(t),this._bind()},_loadShaders:function(){var t=this._gl,r=["precision mediump float;","uniform float uAlpha;","uniform vec2 uMinor;","uniform vec2 uMajor;","uniform vec4 uMinorColor;","uniform vec4 uMajorColor;","uniform vec2 uOffset;","uniform vec2 uResolution;","void main(void) {","  vec2 offsetCoord;","  offsetCoord.x = gl_FragCoord.x - uOffset.x;","  offsetCoord.y = uResolution.y - gl_FragCoord.y - uOffset.y;","  if ((int(mod(offsetCoord.x, uMinor.x)) != 0) && (int(mod(offsetCoord.y, uMinor.y)) != 0)) {","    discard;","  } else {","    if ((int(mod(offsetCoord.x, uMajor.x)) != 0) && (int(mod(offsetCoord.y, uMajor.y)) != 0)) {","      gl_FragColor = uMinorColor;","    }  else {","      gl_FragColor = uMajorColor;","    }","  }","  gl_FragColor.a *= uAlpha;","}"].join("\n"),o=["attribute vec2 aXY;","void main(void) {","   gl_Position = vec4(aXY, 0, 1.0);","}"].join("\n"),e=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(e,o),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))throw new Error("Vertex Shader compilation failed.");var i=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error("Fragment Shader compilation failed.");var s=t.createProgram();if(t.attachShader(s,i),t.attachShader(s,e),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw new Error("Shaders failed to link");return t.useProgram(s),s},_getUniforms:function(t){return{uAlpha:this._gl.getUniformLocation(t,"uAlpha"),uMinorColor:this._gl.getUniformLocation(t,"uMinorColor"),uMajorColor:this._gl.getUniformLocation(t,"uMajorColor"),uMajor:this._gl.getUniformLocation(t,"uMajor"),uMinor:this._gl.getUniformLocation(t,"uMinor"),uOffset:this._gl.getUniformLocation(t,"uOffset"),uResolution:this._gl.getUniformLocation(t,"uResolution")}},_getAttributes:function(t){return{aXY:this._gl.getAttribLocation(t,"aXY")}},_loadVertexBuffer:function(t){var r=this._gl,o=r.createBuffer();return r.bindBuffer(r.ARRAY_BUFFER,o),r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW),o},_bind:function(){var t=this._gl;t.enableVertexAttribArray(this._attributes.aXY),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.vertexAttribPointer(this._attributes.aXY,2,t.FLOAT,!1,0,0),this._setMinor(),this._setMajor(),this._setAlpha(),this._setLineColors(),this._setOffset(),this._setResolution()}},"undefined"!=typeof module&&(module.exports=Graphpaper);